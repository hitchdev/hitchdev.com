<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>The Norway Problem - why StrictYAML won&#39;t do implicit typing - HitchDev</title>
    <meta name="generator" content="Hugo 0.31.1" />

    
    <meta name="description" content="The code that specifies | builds | runs | tests | documents your code.">
    
    <link rel="canonical" href="https://hitchdev.com/strictyaml/why/implicit-typing-removed/">
    
    <meta name="author" content="Colm O&#39;Connor">
    

    <meta property="og:url" content="https://hitchdev.com/strictyaml/why/implicit-typing-removed/">
    <meta property="og:title" content="HitchDev">
    <meta property="og:image" content="https://hitchdev.com/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="HitchDev">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://hitchdev.com/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://hitchdev.com/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://hitchdev.com/fonts/icon.eot');
        src: url('https://hitchdev.com/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://hitchdev.com/fonts/icon.woff')
               format('woff'),
             url('https://hitchdev.com/fonts/icon.ttf')
               format('truetype'),
             url('https://hitchdev.com/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://hitchdev.com/stylesheets/application.css">
    <link rel="stylesheet" href="https://hitchdev.com/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://hitchdev.com/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://hitchdev.com/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://hitchdev.com/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-green palette-accent-teal">




<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
        
        <a style="display:inline;" href="https://hitchdev.com/">hitchdev</a>
        
          
            
            / <a style="display:inline;" href='https://hitchdev.com/strictyaml'>strictyaml</a>
            
            
        
          
            
            / <a style="display:inline;" href='https://hitchdev.com/strictyaml/why'>why</a>
            
            
        
          
            
            / <a style="display:inline;" href='https://hitchdev.com/strictyaml/why/implicit-typing-removed'>implicit-typing-removed</a>
            
            
        
          
            
        
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/hitchdev" title="@hitchdev on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>

</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://hitchdev.com/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://hitchdev.com/images/logo.png">
        </div>
      
      <div class="name">
        <strong>HitchDev </strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="CommandLib" href="https://hitchdev.com/commandlib/">
	
	CommandLib
</a>



  
</li>



<li>
  
    



<a  title="HitchRunPy" href="https://hitchdev.com/hitchrunpy/">
	
	HitchRunPy
</a>



  
</li>



<li>
  
    



<a  title="HitchStory" href="https://hitchdev.com/hitchstory/">
	
	HitchStory
</a>



  
</li>



<li>
  
    



<a  title="SeleniumDirector" href="https://hitchdev.com/seleniumdirector/">
	
	SeleniumDirector
</a>



  
</li>



<li>
  
    



<a  title="StrictYAML" href="https://hitchdev.com/strictyaml/">
	
	StrictYAML
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/hitchdev" target="_blank" title="@hitchdev on GitHub">
              @hitchdev on GitHub
            </a>
          </li>
          

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>The Norway Problem - why StrictYAML won&#39;t do implicit typing </h1>

			

<p>A while back I met an old coworker and he started telling me about this
interesting bug he faced:</p>

<p>&ldquo;So, we started internationalizing the website by creating a config
file. We added the UK, Ireland, France and Germany at first.&rdquo;</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">countries<span class="p">:</span><span class="w">
</span><span class="w"></span>-<span class="w"> </span>GB<span class="w">
</span><span class="w"></span>-<span class="w"> </span>IE<span class="w">
</span><span class="w"></span>-<span class="w"> </span>FR<span class="w">
</span><span class="w"></span>-<span class="w"> </span>DE</code></pre></div>
<p>&ldquo;This was fine for a while. However, when we got around to adding
Norway all hell broke loose&hellip;&rdquo;</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">countries<span class="p">:</span><span class="w">
</span><span class="w"></span>-<span class="w"> </span>GB<span class="w">
</span><span class="w"></span>-<span class="w"> </span>IE<span class="w">
</span><span class="w"></span>-<span class="w"> </span>FR<span class="w">
</span><span class="w"></span>-<span class="w"> </span>DE<span class="w">
</span><span class="w"></span>-<span class="w"> </span>NO</code></pre></div>
<p>The problem here is &ldquo;implicit typing&rdquo; - the YAML specification states that
the parser should be clever about the strings that are entered in to it and
attempt to interpret them and convert them into the relevant types for you.</p>

<p>If you feed this configuration file into <a href="http://pyyaml.org">pyyaml</a> or <a href="https://github.com/hackebrot/poyo">Poyo</a>:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pyyaml</span> <span class="kn">import</span> <span class="n">load</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">load</span><span class="p">(</span><span class="n">the_configuration</span><span class="p">)</span>
<span class="p">{</span><span class="sa"></span><span class="s1">&#39;countries&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa"></span><span class="s1">&#39;GB&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;IE&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;DE&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">]}</span></code></pre></div>
<p>Did you know it snows a <em>lot</em> in &ldquo;False&rdquo;?</p>

<p>Feeding the boolean &ldquo;False&rdquo; to just about any other part
of the program where the string &ldquo;NO&rdquo; of course would break it,
catastrophically, and at the least convenient moment.</p>

<p>It was &ldquo;quick fixed&rdquo; by using quotes - but it&rsquo;s kind of a hack:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">countries<span class="p">:</span><span class="w">
</span><span class="w"></span>-<span class="w"> </span>GB<span class="w">
</span><span class="w"></span>-<span class="w"> </span>IE<span class="w">
</span><span class="w"></span>-<span class="w"> </span>FR<span class="w">
</span><span class="w"></span>-<span class="w"> </span>DE<span class="w">
</span><span class="w"></span>-<span class="w"> </span><span class="s1">&#39;NO&#39;</span></code></pre></div>
<p>StrictYAML sidesteps this problem by optimizing for &ldquo;zero surprises&rdquo; -
only <em>ever</em> parsing to a string or a data type <em>explicitly</em> defined
by the schema:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">strictyaml</span> <span class="kn">import</span> <span class="n">load</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">load</span><span class="p">(</span><span class="n">the_configuration</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="p">{</span><span class="sa"></span><span class="s1">&#39;countries&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa"></span><span class="s1">&#39;GB&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;IE&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;DE&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;NO&#39;</span><span class="p">]}</span></code></pre></div>
<h2 id="string-or-float">String or float?</h2>

<p>This isn&rsquo;t just a problem with countries. This problem hit me a while back when
trying to maintain a configuration file of various software versions. I had
a config file like this, which wasn&rsquo;t a problem:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">python<span class="p">:</span><span class="w"> </span><span class="m">3.5</span>.<span class="m">3</span><span class="w">
</span><span class="w"></span>postgres<span class="p">:</span><span class="w"> </span><span class="m">9.3</span>.<span class="m">0</span></code></pre></div>
<p>And then, as soon as I changed it <em>very</em> slightly:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">python<span class="p">:</span><span class="w"> </span><span class="m">3.5</span>.<span class="m">3</span><span class="w">
</span><span class="w"></span>postgres<span class="p">:</span><span class="w"> </span><span class="m">9.3</span></code></pre></div>
<p>I started getting type errors:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">ruamel.yaml</span> <span class="kn">import</span> <span class="n">load</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">load</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span> <span class="o">==</span> <span class="p">[{</span><span class="sa"></span><span class="s2">&#34;python&#34;</span><span class="p">:</span> <span class="sa"></span><span class="s2">&#34;3.5.3&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;postgres&#34;</span><span class="p">:</span> <span class="mf">9.3</span><span class="p">}]</span>    <span class="c1"># oops those *both* should have been strings</span></code></pre></div>
<p>Again, it can be &lsquo;quick fixed&rsquo; with quotes, but again, the real fix
is simply not to interpret types at all.</p>

<h2 id="the-world-s-most-buggy-name">The world&rsquo;s most buggy name</h2>

<p><a href="http://www.wired.com/2015/11/null">Christopher Null</a> has a name that is notorious for breaking
software code - airlines, banks, everything. YAML, sadly, is no exception:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">first<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>Christopher<span class="w">
</span><span class="w"></span>surname<span class="p">:</span><span class="w"> </span>Null</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Is it okay if we just call you Christopher None instead?</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">load</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="sa"></span><span class="s2">&#34;first name&#34;</span><span class="p">:</span> <span class="sa"></span><span class="s2">&#34;Christopher&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;surname&#34;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span></code></pre></div>
<h2 id="theory-of-astonishment">Theory of astonishment</h2>

<p>In the above cases, implicit typing represents a major violation of <a href="https://en.wikipedia.org/wiki/Principle_of_least_astonishment">the principle of least astonishment</a>.</p>


			<aside class="copyright" role="note">
				
				&copy; 2019 Copyright (C) 2018 &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://hitchdev.com/hitchstory/approach/test-investment/" title="Tests are an investment">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Tests are an investment
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://hitchdev.com/tropes/unit-test-paradox/" title="The Unit Test Paradox">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              The Unit Test Paradox
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="https://hitchdev.com/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

